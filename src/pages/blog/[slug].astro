---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({ params: { slug: post.slug } }));
}

const { slug } = Astro.params;
const post = (await getCollection('blog')).find((p) => p.slug === slug);

if (!post) {
  return Astro.redirect('/blog');
}

const { Content } = await post.render();
---
<BaseLayout title={post.data.title} description={post.data.description}>
  <article class="mx-auto max-w-3xl px-4 py-12 sm:px-6">
    <a href="/blog" class="text-sm text-accent-blue hover:underline">← Blog</a>
    <header class="mt-4">
      <h1 class="text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl">
        {post.data.title}
      </h1>
      <p class="mt-2 text-gray-600">
        {post.data.description}
      </p>
      <time datetime={post.data.pubDate.toISOString()} class="mt-2 block text-sm text-gray-500">
        {post.data.pubDate.toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' })}
      </time>
    </header>
    <div class="prose prose-gray mt-8 max-w-none prose-headings:font-semibold prose-a:text-accent-blue prose-a:no-underline hover:prose-a:underline">
      <Content />
    </div>
    <footer class="mt-10 border-t border-gray-200 pt-6">
      <a href="/contact" class="text-accent-blue hover:underline">Book a diagnostic visit</a>
      <span class="text-gray-400"> · </span>
      <a href="/lead-magnet" class="text-accent-blue hover:underline">Get our free condensation checklist</a>
    </footer>
  </article>
</BaseLayout>
