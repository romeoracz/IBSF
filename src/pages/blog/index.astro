---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { siteConfig } from '../../site.config';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog')).sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---
<BaseLayout
  title={`Blog & Resources â€“ ${siteConfig.name}`}
  description="Articles on damp surveys, condensation, sick building syndrome and ventilation. Southampton, Winchester and London."
>
  <div class="mx-auto max-w-4xl px-4 py-12 sm:px-6">
    <h1 class="text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl">
      Blog & resources
    </h1>
    <p class="mt-2 text-gray-600">
      Guides and articles on damp, condensation, indoor air quality and building forensics.
    </p>

    <section class="mt-10" aria-labelledby="lead-magnet-heading">
      <div class="rounded-xl border-2 border-primary bg-primary-light/30 p-6">
        <h2 id="lead-magnet-heading" class="text-lg font-semibold text-gray-900">Free guide</h2>
        <p class="mt-1 text-gray-700">
          Download our checklist: <strong>Preventing condensation after insulation</strong>. Practical steps to avoid mould and damp after retrofit.
        </p>
        <a href="/lead-magnet" class="mt-4 inline-flex rounded-lg bg-primary px-6 py-3 font-semibold text-white no-underline hover:bg-primary-hover">
          Get the free checklist
        </a>
      </div>
    </section>

    <ul class="mt-12 space-y-8">
      {posts.map((post) => (
        <li>
          <article class="border-b border-gray-200 pb-8 last:border-0">
            <a href={`/blog/${post.slug}`} class="no-underline group">
              <h2 class="text-xl font-semibold text-gray-900 group-hover:text-primary">
                {post.data.title}
              </h2>
              <p class="mt-1 text-gray-600">
                {post.data.description}
              </p>
              <time datetime={post.data.pubDate.toISOString()} class="mt-2 block text-sm text-gray-500">
                {post.data.pubDate.toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' })}
              </time>
            </a>
          </article>
        </li>
      ))}
    </ul>
  </div>
</BaseLayout>
